{
  "loadMethods": {
    "listConnectedTools": {
      "description": "Return tool nodes connected via the agent's 'tool' handle.",
      "params": []
    },
    "listConnectedParsers": {
      "description": "Return parser nodes connected via the agent's 'parser' handle.",
      "params": []
    },
    "listConnectedNextTargets": {
      "description": "Return primary next-step nodes connected via the agent's 'next' handle.",
      "params": []
    },
    "listModels": {
      "description": "Return available LLM models.",
      "params": []
    }
  },
  "label": "Agent Engine",
  "name": "agentEngine",
  "icons": {
    "default": "https://raw.githubusercontent.com/weave-services/node-assets/refs/heads/main/node-list/node-schemas/agent2.png",
    "light": "https://raw.githubusercontent.com/weave-services/node-assets/refs/heads/main/node-list/node-schemas/agent2.png",
    "dark": "https://raw.githubusercontent.com/weave-services/node-assets/refs/heads/main/node-list/node-schemas/agent2.png"
  },
  "type": "action",
  "category": "Artificial Intelligence",
  "version": 1,
  "description": "Reentrant Agent (Plan → Tool → Agent → Parser/Next/Complete). Tools & parser connect via dedicated handles; 'next' is the primary workflow edge.",
  "incoming": 1,
  "outgoing": -1,
  "ports": {
    "inputs": [
      { "name": "in", "label": "In", "multiple": true }
    ],
    "outputs": [
      { "name": "tool",   "label": "Tool",   "multiple": true },
      { "name": "parser", "label": "Parser", "multiple": true },
      { "name": "next",   "label": "Next",   "multiple": false }
    ]
  },
  "actions": [
    {
      "label": "Operation",
      "name": "operation",
      "type": "options",
      "options": [
        { "label": "Plan & Act (Reentrant)", "name": "planAct" },
        { "label": "Parse Only (no planning)", "name": "parseOnly" }
      ],
      "default": "planAct"
    }
  ],
  "credentials": [
    {
      "label": "Credential Method",
      "name": "credentialMethod",
      "type": "string",
      "options": [
        { "label": "OpenAI API Key", "name": "openAIApi" }
      ],
      "default": "openAIApi"
    }
  ],
  "inputParameters": [
    {
      "label": "Reentrant",
      "name": "reentrant",
      "type": "boolean",
      "description": "Enable agent reentrancy (tool → agent → next).",
      "default": true,
      "show": { "actions.operation": ["planAct"] }
    },
    {
      "label": "Model",
      "name": "model",
      "type": "asyncOptions",
      "loadMethod": "listModels",
      "description": "AI model used by the agent.",
      "default": "gpt-4o-mini",
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },
    {
      "label": "Connected Tools (via 'tool' handle)",
      "name": "connectedTools",
      "type": "asyncOptions",
      "loadMethod": "listConnectedTools",
      "description": "Tool nodes attached by edges from the 'tool' port.",
      "readonly": true,
      "show": { "actions.operation": ["planAct"] }
    },
    {
      "label": "Connected Parsers (via 'parser' handle)",
      "name": "connectedParsers",
      "type": "asyncOptions",
      "loadMethod": "listConnectedParsers",
      "description": "Parser nodes attached by edges from the 'parser' port.",
      "readonly": true,
      "optional": true,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },
    {
      "label": "Next Targets (via 'next' handle)",
      "name": "connectedNext",
      "type": "asyncOptions",
      "loadMethod": "listConnectedNextTargets",
      "description": "Primary next-step nodes attached by edges from the 'next' port.",
      "readonly": true
    },
    {
      "label": "Planning: Max Steps",
      "name": "planning_maxSteps",
      "type": "number",
      "description": "Maximum planning turns before completion/next.",
      "default": 8,
      "show": { "actions.operation": ["planAct"] }
    },
    {
      "label": "Allow Parallel Tools",
      "name": "planning_allowParallelTools",
      "type": "boolean",
      "description": "If true, the agent may plan parallel tool calls (runtime still serializes).",
      "default": false,
      "show": { "actions.operation": ["planAct"] }
    },
    {
      "label": "System Prompt",
      "name": "system_prompt",
      "type": "string",
      "default": "",
      "placeholder": "You are a helpful agent that plans tool calls...",
      "description": "System instruction for the agent.",
      "optional": true
    },
    {
      "label": "User Prompt",
      "name": "user_prompt",
      "type": "string",
      "default": "",
      "placeholder": "Summarize results and decide next action.",
      "description": "Primary user/task prompt.",
      "optional": true
    }
  ],
  "filePath": "services/AgentEngine.ts"
}
