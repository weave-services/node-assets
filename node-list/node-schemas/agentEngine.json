{
  "loadMethods": {
    "listModels": {
      "description": "Return available LLM models (UI can pass values.category).",
      "params": []
    },
    "getNetworkProviders": {
      "description": "Return available network providers.",
      "params": []
    },
    "getPairAddress": {
      "description": "Return address pairs for a selected network/provider.",
      "params": []
    },
    "listConnectedTools": {
      "description": "Return nodes connected from the agent via the 'tool' handle.",
      "params": []
    },
    "listConnectedParsers": {
      "description": "Return nodes connected from the agent via the 'parser' handle.",
      "params": []
    },
    "listConnectedNextTargets": {
      "description": "Return nodes connected from the agent via the 'next' handle.",
      "params": []
    }
  },
  "label": "Agent Engine",
  "name": "agentEngine",
  "icons": {
    "default": "https://raw.githubusercontent.com/weave-services/node-assets/refs/heads/main/node-list/node-schemas/agent2.png",
    "light": "https://raw.githubusercontent.com/weave-services/node-assets/refs/heads/main/node-list/node-schemas/agent2.png",
    "dark": "https://raw.githubusercontent.com/weave-services/node-assets/refs/heads/main/node-list/node-schemas/agent2.png"
  },
  "type": "action",
  "category": "Artificial Intelligence",
  "version": 1,
  "description": "Reentrant Agent (Plan → Tool → Agent → Parser/Next/Complete). Tools & parsers connect via bottom handles; the right-most handle is the primary next-step output.",
  "incoming": 1,
  "outgoing": 3,

  "ports": {
    "inputs": [
      { "name": "in", "label": "In", "multiple": true }
    ],
    "outputs": [
      { "name": "tool",   "label": "Tool",   "multiple": true,  "position": "bottom", "handle": "tool" },
      { "name": "parser", "label": "Parser", "multiple": true,  "position": "bottom", "handle": "parser" },
      { "name": "next",   "label": "Next",   "multiple": true,  "position": "right",  "handle": "next" }
    ]
  },

  "actions": [
    {
      "label": "Operation",
      "name": "operation",
      "type": "options",
      "options": [
        { "label": "Plan & Act (Reentrant)", "name": "planAct" },
        { "label": "Parse Only (no planning)", "name": "parseOnly" }
      ],
      "default": "planAct"
    }
  ],

  "credentials": [
    {
      "label": "Credential Method",
      "name": "credentialMethod",
      "type": "string",
      "options": [
        { "label": "OpenAI API Key", "name": "openAIApi" }
      ],
      "default": "openAIApi"
    }
  ],

  "inputParameters": [
    {
      "label": "Model",
      "name": "model",
      "type": "options",
      "options": [
        { "label": "gpt-3.5-turbo", "name": "gpt-3.5-turbo" },
        { "label": "gpt-5", "name": "gpt-5" },
        { "label": "gpt-3.5-turbo-0125", "name": "gpt-3.5-turbo-0125" },
        { "label": "gpt-4.1-preview", "name": "gpt-4.1" },
        { "label": "gpt-4o", "name": "gpt-4o" },
        { "label": "gpt-4o-mini", "name": "gpt-4o-mini" },
        { "label": "gpt-4o-search-preview", "name": "gpt-4o-search-preview" },
        { "label": "gpt-4-turbo-preview", "name": "gpt-4-turbo-preview" },
        { "label": "gpt-4.1-mini", "name": "gpt-4.1-mini" },
        { "label": "gpt-4.1-nano", "name": "gpt-4.1-nano" },
        { "label": "o1-mini", "name": "o1-mini" },
        { "label": "o1-preview", "name": "o1-preview" }
      ],
      "description": "Static model options (fallback if async lookup unavailable).",
      "default": "gpt-3.5-turbo",
      "optional": true,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },

    {
      "label": "Max Tokens",
      "name": "max_tokens",
      "type": "number",
      "description": "The maximum number of tokens to generate.",
      "optional": true,
      "default": 4096,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },
    {
      "label": "Top P",
      "name": "top_p",
      "type": "number",
      "description": "Nucleus sampling parameter to control diversity (0..1).",
      "optional": true,
      "default": 1.0,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },
    {
      "label": "Temperature",
      "name": "temperature",
      "type": "number",
      "description": "Controls randomness in output (0..1).",
      "optional": true,
      "default": 0.7,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },
    {
      "label": "Stream",
      "name": "stream",
      "type": "boolean",
      "description": "Stream tokens as they arrive.",
      "optional": true,
      "default": false,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },
    {
      "label": "System Prompt",
      "name": "system_prompt",
      "type": "string",
      "default": "",
      "placeholder": "You are a helpful agent that plans tool calls...",
      "description": "System instruction for the agent.",
      "optional": true,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },
    {
      "label": "User Prompt",
      "name": "user_prompt",
      "type": "string",
      "default": "",
      "placeholder": "Summarize results and decide next action.",
      "description": "Primary user/task prompt.",
      "optional": true,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },

    {
      "label": "Connected Tools (via 'tool' handle)",
      "name": "connectedTools",
      "type": "asyncOptions",
      "loadMethod": "listConnectedTools",
      "description": "Tool nodes attached by edges from the 'tool' port (bottom).",
      "readonly": true,
      "show": { "actions.operation": ["planAct"] }
    },
    {
      "label": "Connected Parsers (via 'parser' handle)",
      "name": "connectedParsers",
      "type": "asyncOptions",
      "loadMethod": "listConnectedParsers",
      "description": "Parser nodes attached by edges from the 'parser' port (bottom).",
      "readonly": true,
      "optional": true,
      "show": { "actions.operation": ["planAct", "parseOnly"] }
    },
    {
      "label": "Next Targets (via 'next' handle)",
      "name": "connectedNext",
      "type": "asyncOptions",
      "loadMethod": "listConnectedNextTargets",
      "description": "Primary next-step nodes attached by edges from the 'next' port (right).",
      "readonly": true
    }
  ],

  "filePath": "services/AgentEngine.ts"
}
